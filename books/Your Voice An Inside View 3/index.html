<!DOCTYPE html>
<html lang="ru" class="theme-vintage">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Voice: An Inside View 3</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="theme-vintage">
    <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º -->
    <div class="theme-switcher">
        <div class="theme-switcher-label">üé® –¢–µ–º–∞</div>
        <div class="theme-buttons">
            <div class="theme-btn theme-btn-vintage active" onclick="setTheme('vintage')" title="–í–∏–Ω—Ç–∞–∂–Ω–∞—è —Ç–µ–º–∞"></div>
            <div class="theme-btn theme-btn-dark" onclick="setTheme('dark')" title="–ß–µ—Ä–Ω–∞—è —Ç–µ–º–∞"></div>
        </div>
    </div>
    
    <div class="book-header">
        <h1 class="book-title">Your Voice: An Inside View 3</h1>
        <p class="book-author">Scott McCoy</p>
    </div>
    
    <div class="toc">
        <h2>üìö –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</h2>
        <ul>
            <li>
                <a href="chapter_01_Table of Contents.html">
                    <span>Table of Contents</span>
                    <span class="chapter-number">1</span>
                </a>
            </li>
            <li>
                <a href="chapter_02_Listening.html">
                    <span>Listening</span>
                    <span class="chapter-number">2</span>
                </a>
            </li>
            <li>
                <a href="chapter_03_Sound, Part 1.html">
                    <span>Sound, Part 1</span>
                    <span class="chapter-number">3</span>
                </a>
            </li>
            <li>
                <a href="chapter_04_Sound, Part 2.html">
                    <span>Sound, Part 2</span>
                    <span class="chapter-number">4</span>
                </a>
            </li>
            <li>
                <a href="chapter_05_References.html">
                    <span>References</span>
                    <span class="chapter-number">5</span>
                </a>
            </li>
            <li>
                <a href="chapter_06_Resonance.html">
                    <span>Resonance</span>
                    <span class="chapter-number">6</span>
                </a>
            </li>
            <li>
                <a href="chapter_07_References.html">
                    <span>References</span>
                    <span class="chapter-number">7</span>
                </a>
            </li>
            <li>
                <a href="chapter_08_Formants.html">
                    <span>Formants</span>
                    <span class="chapter-number">8</span>
                </a>
            </li>
            <li>
                <a href="chapter_09_References.html">
                    <span>References</span>
                    <span class="chapter-number">9</span>
                </a>
            </li>
            <li>
                <a href="chapter_10_Analysis.html">
                    <span>Analysis</span>
                    <span class="chapter-number">10</span>
                </a>
            </li>
            <li>
                <a href="chapter_11_References.html">
                    <span>References</span>
                    <span class="chapter-number">11</span>
                </a>
            </li>
            <li>
                <a href="chapter_12_Anatomy.html">
                    <span>Anatomy</span>
                    <span class="chapter-number">12</span>
                </a>
            </li>
            <li>
                <a href="chapter_13_References.html">
                    <span>References</span>
                    <span class="chapter-number">13</span>
                </a>
            </li>
            <li>
                <a href="chapter_14_Breathing.html">
                    <span>Breathing</span>
                    <span class="chapter-number">14</span>
                </a>
            </li>
            <li>
                <a href="chapter_15_Summary of Respiratory Muscle Fundtions and Locations.html">
                    <span>Summary of Respiratory Muscle Fundtions and Locations</span>
                    <span class="chapter-number">15</span>
                </a>
            </li>
            <li>
                <a href="chapter_16_References.html">
                    <span>References</span>
                    <span class="chapter-number">16</span>
                </a>
            </li>
            <li>
                <a href="chapter_17_Phonation.html">
                    <span>Phonation</span>
                    <span class="chapter-number">17</span>
                </a>
            </li>
            <li>
                <a href="chapter_18_Summary of Phonatory Muscle Functions and Locations.html">
                    <span>Summary of Phonatory Muscle Functions and Locations</span>
                    <span class="chapter-number">18</span>
                </a>
            </li>
            <li>
                <a href="chapter_19_References.html">
                    <span>References</span>
                    <span class="chapter-number">19</span>
                </a>
            </li>
            <li>
                <a href="chapter_20_Health.html">
                    <span>Health</span>
                    <span class="chapter-number">20</span>
                </a>
            </li>
            <li>
                <a href="chapter_21_References.html">
                    <span>References</span>
                    <span class="chapter-number">21</span>
                </a>
            </li>
            <li>
                <a href="chapter_22_Registration.html">
                    <span>Registration</span>
                    <span class="chapter-number">22</span>
                </a>
            </li>
            <li>
                <a href="chapter_23_References.html">
                    <span>References</span>
                    <span class="chapter-number">23</span>
                </a>
            </li>
            <li>
                <a href="chapter_24_Articulation.html">
                    <span>Articulation</span>
                    <span class="chapter-number">24</span>
                </a>
            </li>
            <li>
                <a href="chapter_25_Summary of Articulatory Muscle Function and Location.html">
                    <span>Summary of Articulatory Muscle Function and Location</span>
                    <span class="chapter-number">25</span>
                </a>
            </li>
            <li>
                <a href="chapter_26_References.html">
                    <span>References</span>
                    <span class="chapter-number">26</span>
                </a>
            </li>
            <li>
                <a href="chapter_27_Hearing.html">
                    <span>Hearing</span>
                    <span class="chapter-number">27</span>
                </a>
            </li>
            <li>
                <a href="chapter_28_Summary of hearing anatomy.html">
                    <span>Summary of hearing anatomy</span>
                    <span class="chapter-number">28</span>
                </a>
            </li>
            <li>
                <a href="chapter_29_References.html">
                    <span>References</span>
                    <span class="chapter-number">29</span>
                </a>
            </li>
            <li>
                <a href="chapter_30_Brain.html">
                    <span>Brain</span>
                    <span class="chapter-number">30</span>
                </a>
            </li>
            <li>
                <a href="chapter_31_References.html">
                    <span>References</span>
                    <span class="chapter-number">31</span>
                </a>
            </li>
            <li>
                <a href="chapter_32_Appendix 1 Listening to Singers, Rating Sheet.html">
                    <span>Appendix 1 Listening to Singers, Rating Sheet</span>
                    <span class="chapter-number">32</span>
                </a>
            </li>
            <li>
                <a href="chapter_33_Appendix 2 Frequencies of the equally tempered scale.html">
                    <span>Appendix 2 Frequencies of the equally tempered scale</span>
                    <span class="chapter-number">33</span>
                </a>
            </li>
            <li>
                <a href="chapter_34_About the Authors.html">
                    <span>About the Authors</span>
                    <span class="chapter-number">34</span>
                </a>
            </li>
        </ul>
    </div>
    
    <div class="navigation">
        <p>–≠—Ç–∞ –∫–Ω–∏–≥–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç 34 –≥–ª–∞–≤. –í—ã–±–µ—Ä–∏—Ç–µ –≥–ª–∞–≤—É –∏–∑ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—è –≤—ã—à–µ –¥–ª—è —á—Ç–µ–Ω–∏—è.</p>
    </div>
    
    <script>
        // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º
        function setTheme(theme) {
            // –£–¥–∞–ª—è–µ–º –≤—Å–µ –∫–ª–∞—Å—Å—ã —Ç–µ–º —Å body –∏ html
            document.body.className = document.body.className.replace(/theme-\w+/g, '');
            document.documentElement.className = document.documentElement.className.replace(/theme-\w+/g, '');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –∫–ª–∞—Å—Å —Ç–µ–º—ã –∫ body –∏ html
            document.body.classList.add('theme-' + theme);
            document.documentElement.classList.add('theme-' + theme);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±–æ—Ä –≤ localStorage
            localStorage.setItem('reading-theme', theme);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
            document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.theme-btn-' + theme).classList.add('active');
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Ç–µ–º—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        function loadSavedTheme() {
            const savedTheme = localStorage.getItem('reading-theme') || 'vintage';
            setTheme(savedTheme);
        }
        
        // –§—É–Ω–∫—Ü–∏—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –≥–ª–∞–≤—ã –ø–æ –∏–Ω–¥–µ–∫—Å—É
        function downloadChapterByIndex(chapterIndex, format) {
            // –ò–∑–≤–ª–µ–∫–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏ –∫–Ω–∏–≥–∏ –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ URL
            // –≠—Ç–æ –∏ –µ—Å—Ç—å site_path –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
            let bookPath = '';
            
            const currentPath = window.location.pathname;
            const pathParts = currentPath.split('/');
            
            // –ò—â–µ–º –ø–∞–ø–∫—É —Å –∫–Ω–∏–≥–æ–π –≤ –ø—É—Ç–∏
            for (let i = 0; i < pathParts.length; i++) {
                if (pathParts[i] === 'books' && pathParts[i + 1]) {
                    // –ù–∞—à–ª–∏ –ø–∞–ø–∫—É books, —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç - –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏
                    bookPath = decodeURIComponent(pathParts[i + 1]);
                    break;
                } else if (pathParts[i] === 'book' && pathParts[i + 1]) {
                    // URL —á–µ—Ä–µ–∑ —Ä–æ—É—Ç /book/
                    bookPath = decodeURIComponent(pathParts[i + 1]);
                    break;
                }
            }
            
            // –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –ø–æ–ø—Ä–æ–±—É–µ–º –∏–∑–≤–ª–µ—á—å –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–π —á–∞—Å—Ç–∏ –ø—É—Ç–∏ –¥–æ index.html
            if (!bookPath) {
                const match = currentPath.match(/\/([^\/]+)\/[^\/]*$/);
                if (match) {
                    bookPath = decodeURIComponent(match[1]);
                }
            }
            
            console.log('–¢–µ–∫—É—â–∏–π URL:', currentPath);
            console.log('–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –ø—É—Ç—å –∫ –∫–Ω–∏–≥–µ:', bookPath);
            
            if (bookPath) {
                fetch(`/api/book-info?path=${encodeURIComponent(bookPath)}`)
                    .then(response => response.json())
                    .then(data => {
                        console.log('–û—Ç–≤–µ—Ç –æ—Ç API:', data);
                        if (data.book_id) {
                            const downloadUrl = `/download-chapter/${data.book_id}/${chapterIndex}/${format}`;
                            
                            const link = document.createElement('a');
                            link.href = downloadUrl;
                            link.style.display = 'none';
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                        } else {
                            alert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–Ω–∏–≥–µ: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                        }
                    })
                    .catch(error => {
                        console.error('–û—à–∏–±–∫–∞:', error);
                        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–∞');
                    });
            } else {
                alert('–ù–µ —É–¥–∞–µ—Ç—Å—è –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏');
            }
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –∫ –∫–∞–∂–¥–æ–π –≥–ª–∞–≤–µ
        document.addEventListener('DOMContentLoaded', function() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Ç–µ–º—É
            loadSavedTheme();
            
            const chapters = document.querySelectorAll('.toc li');
            chapters.forEach((li, index) => {
                const downloadDiv = document.createElement('div');
                downloadDiv.className = 'chapter-download-buttons';
                downloadDiv.innerHTML = `
                    <button onclick="downloadChapterByIndex(${index}, 'epub')" class="mini-download-btn epub-btn" title="–°–∫–∞—á–∞—Ç—å –≤ EPUB">üìñ</button>
                    <button onclick="downloadChapterByIndex(${index}, 'docx')" class="mini-download-btn docx-btn" title="–°–∫–∞—á–∞—Ç—å –≤ DOCX">üìÑ</button>
                `;
                li.appendChild(downloadDiv);
            });
        });
    </script>
</body>
</html>